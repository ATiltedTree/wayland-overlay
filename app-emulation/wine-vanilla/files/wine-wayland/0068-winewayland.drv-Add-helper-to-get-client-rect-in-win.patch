From 4e5cb40cd4c7659303950bf2a96cdcb2d6e0aa92 Mon Sep 17 00:00:00 2001
From: Alexandros Frantzis <alexandros.frantzis@collabora.com>
Date: Thu, 30 Sep 2021 13:41:29 +0300
Subject: [PATCH 068/147] winewayland.drv: Add helper to get client rect in
 window coordinates.

Signed-off-by: Alexandros Frantzis <alexandros.frantzis@collabora.com>
---
 dlls/winewayland.drv/waylanddrv.h |  6 ++++++
 dlls/winewayland.drv/window.c     | 23 +++++++++++++++++++++++
 2 files changed, 29 insertions(+)

diff --git a/dlls/winewayland.drv/waylanddrv.h b/dlls/winewayland.drv/waylanddrv.h
index ed2d3296ef4..373d68894b7 100644
--- a/dlls/winewayland.drv/waylanddrv.h
+++ b/dlls/winewayland.drv/waylanddrv.h
@@ -420,6 +420,12 @@ void wayland_set_cursor_if_current_invalid(HCURSOR hcursor);
 xkb_layout_index_t _xkb_state_get_active_layout(struct xkb_state *xkb_state);
 int _xkb_keysyms_to_utf8(const xkb_keysym_t *syms, int nsyms, char *utf8, int utf8_size);
 
+/**********************************************************************
+ *          Misc. helpers
+ */
+
+void wayland_get_client_rect_in_win_coords(HWND hwnd, RECT *client_rect);
+
 /**********************************************************************
  *          USER driver functions
  */
diff --git a/dlls/winewayland.drv/window.c b/dlls/winewayland.drv/window.c
index ba14fc747f8..15f7776e5da 100644
--- a/dlls/winewayland.drv/window.c
+++ b/dlls/winewayland.drv/window.c
@@ -1551,3 +1551,26 @@ LRESULT CDECL WAYLAND_WindowMessage(HWND hwnd, UINT msg, WPARAM wp, LPARAM lp)
 
     return 0;
 }
+
+/*****************************************************************************
+ *           wayland_get_client_rect_in_win_coords
+ */
+void wayland_get_client_rect_in_win_coords(HWND hwnd, RECT *client_rect)
+{
+    RECT window_rect;
+    POINT origin = {0, 0};
+
+    if (!ClientToScreen(hwnd, &origin)) goto err;
+    if (!GetWindowRect(hwnd, &window_rect)) goto err;
+    if (!GetClientRect(hwnd, client_rect)) goto err;
+
+    OffsetRect(client_rect,
+               origin.x - window_rect.left,
+               origin.y - window_rect.top);
+
+    return;
+
+err:
+    ERR("Failed to get client rect for hwnd %p", hwnd);
+    SetRectEmpty(client_rect);
+}
-- 
2.34.1

